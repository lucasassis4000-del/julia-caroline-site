<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamento | J√∫lia Caroline</title>
    <link rel="icon" href="assets/img/favicon.jpg" type="image/jpeg" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: { colors: { 'casulo-gold': '#C5A059', 'casulo-bg': '#F9F8F4', 'casulo-text': '#333333' }, fontFamily: { 'serif': ['"Playfair Display"', 'serif'], 'sans': ['"Montserrat"', 'sans-serif'] } }
            }
        }
    </script>
    <style>
        .step { display: none; }
        .step.active { display: block; animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .service-card.selected { border-color: #C5A059; background-color: #FFF; box-shadow: 0 10px 30px -10px rgba(197, 160, 89, 0.2); }
        .time-btn.selected { background-color: #C5A059; color: white; border-color: #C5A059; }
    </style>
</head>
<body class="bg-casulo-bg text-casulo-text font-sans min-h-screen flex items-center justify-center p-4">

    <div class="max-w-2xl w-full bg-white rounded-[2.5rem] shadow-2xl shadow-gray-200/50 overflow-hidden relative border border-white">
        <div class="h-1 bg-gray-100 w-full"><div id="progress" class="h-full bg-casulo-gold transition-all duration-700 ease-out" style="width: 33%"></div></div>
        
        <div class="p-10 lg:p-14">
            <div class="flex justify-between items-center mb-10">
                <a href="index.html" class="text-[10px] font-bold tracking-[0.2em] uppercase text-gray-400 hover:text-casulo-gold transition-colors" aria-label="Cancelar agendamento e voltar para a p√°gina inicial">‚úï Cancelar</a>
                <span class="font-serif text-2xl text-casulo-gold">Agendamento</span>
            </div>

            <!-- Passo 1: Sele√ß√£o do Servi√ßo -->
            <div id="step1" class="step active" role="region" aria-labelledby="step1-heading">
                <h2 id="step1-heading" class="text-3xl font-serif mb-2 text-center text-casulo-text">Como posso ajudar?</h2>
                <p class="text-center text-gray-400 font-light mb-10 text-sm">Selecione o atendimento ideal para seu momento.</p>
                
                <div class="space-y-4">
                    <div class="service-card border border-gray-100 rounded-2xl p-6 cursor-pointer hover:border-casulo-gold/30 flex items-center gap-6 group transition-all" onclick="selectService('neuro', this)" role="button" tabindex="0" aria-label="Selecionar Avalia√ß√£o Neuropsicol√≥gica">
                        <div class="w-12 h-12 rounded-full bg-[#F9F8F4] flex items-center justify-center text-2xl group-hover:bg-casulo-gold group-hover:text-white transition-colors" aria-hidden="true">üß†</div>
                        <div>
                            <h3 class="font-serif text-lg text-casulo-text">Avalia√ß√£o Neuropsicol√≥gica</h3>
                            <p class="text-xs text-gray-400 mt-1 uppercase tracking-wide">Mem√≥ria, TDAH, Autismo</p>
                        </div>
                    </div>
                    <div class="service-card border border-gray-100 rounded-2xl p-6 cursor-pointer hover:border-casulo-gold/30 flex items-center gap-6 group transition-all" onclick="selectService('tcc', this)" role="button" tabindex="0" aria-label="Selecionar Psicoterapia TCC">
                        <div class="w-12 h-12 rounded-full bg-[#F9F8F4] flex items-center justify-center text-2xl group-hover:bg-casulo-gold group-hover:text-white transition-colors" aria-hidden="true">üõãÔ∏è</div>
                        <div>
                            <h3 class="font-serif text-lg text-casulo-text">Psicoterapia TCC</h3>
                            <p class="text-xs text-gray-400 mt-1 uppercase tracking-wide">Ansiedade e Depress√£o</p>
                        </div>
                    </div>
                    <div class="service-card border border-gray-100 rounded-2xl p-6 cursor-pointer hover:border-casulo-gold/30 flex items-center gap-6 group transition-all" onclick="selectService('homecare', this)" role="button" tabindex="0" aria-label="Selecionar Home Care para Idosos">
                        <div class="w-12 h-12 rounded-full bg-[#F9F8F4] flex items-center justify-center text-2xl group-hover:bg-casulo-gold group-hover:text-white transition-colors" aria-hidden="true">üè°</div>
                        <div>
                            <h3 class="font-serif text-lg text-casulo-text">Home Care / Idosos</h3>
                            <p class="text-xs text-gray-400 mt-1 uppercase tracking-wide">Atendimento no Domic√≠lio</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Passo 2: Sele√ß√£o de Data e Hora -->
            <div id="step2" class="step" role="region" aria-labelledby="step2-heading">
                <h2 id="step2-heading" class="text-3xl font-serif mb-2 text-center text-casulo-text">Sua disponibilidade</h2>
                <p class="text-center text-gray-400 font-light mb-10 text-sm">Escolha a data e hor√°rio de prefer√™ncia.</p>

                <input type="date" id="dateInput" class="w-full p-4 mb-8 rounded-xl border border-gray-200 focus:border-casulo-gold outline-none text-gray-600 font-medium bg-[#F9F8F4]" onchange="checkStep2()" aria-label="Selecione a data do agendamento">
                
                <div class="grid grid-cols-3 gap-3 mb-10" role="group" aria-label="Hor√°rios dispon√≠veis">
                    <button onclick="selectTime('08:00', this)" class="time-btn border border-gray-200 py-3 rounded-xl text-sm font-medium hover:border-casulo-gold transition-all" role="radio" aria-checked="false">08:00</button>
                    <button onclick="selectTime('10:00', this)" class="time-btn border border-gray-200 py-3 rounded-xl text-sm font-medium hover:border-casulo-gold transition-all" role="radio" aria-checked="false">10:00</button>
                    <button onclick="selectTime('14:00', this)" class="time-btn border border-gray-200 py-3 rounded-xl text-sm font-medium hover:border-casulo-gold transition-all" role="radio" aria-checked="false">14:00</button>
                    <button onclick="selectTime('16:00', this)" class="time-btn border border-gray-200 py-3 rounded-xl text-sm font-medium hover:border-casulo-gold transition-all" role="radio" aria-checked="false">16:00</button>
                    <button onclick="selectTime('18:00', this)" class="time-btn border border-gray-200 py-3 rounded-xl text-sm font-medium hover:border-casulo-gold transition-all" role="radio" aria-checked="false">18:00</button>
                </div>
                
                <div class="flex justify-between items-center pt-6 border-t border-gray-50">
                    <button onclick="setStep(1)" class="text-xs uppercase tracking-widest text-gray-400 hover:text-casulo-text" aria-label="Voltar para a sele√ß√£o de servi√ßo">Voltar</button>
                    <button id="btnStep2" disabled onclick="setStep(3)" class="bg-casulo-text text-white px-8 py-3 rounded-full font-medium text-xs uppercase tracking-widest hover:bg-casulo-gold disabled:opacity-30 disabled:cursor-not-allowed transition-all" aria-label="Continuar para o pr√≥ximo passo">Continuar</button>
                </div>
            </div>

            <!-- Passo 3: Confirma√ß√£o de Dados -->
            <div id="step3" class="step" role="region" aria-labelledby="step3-heading">
                <h2 id="step3-heading" class="text-3xl font-serif mb-2 text-center text-casulo-text">Quase l√°...</h2>
                <p class="text-center text-gray-400 font-light mb-10 text-sm">Seus dados para confirmarmos o agendamento.</p>

                <div class="bg-[#F9F8F4] p-6 rounded-2xl mb-8 border border-gray-100 flex items-center gap-4" role="status" aria-live="polite">
                    <div class="w-10 h-10 rounded-full bg-casulo-gold flex items-center justify-center text-white font-serif italic text-lg" aria-hidden="true">i</div>
                    <div class="text-sm">
                        <p class="font-bold text-casulo-text" id="sumService">...</p>
                        <p class="text-gray-500"><span id="sumDate">...</span> √†s <span id="sumTime">...</span></p>
                    </div>
                </div>

                <div class="space-y-4 mb-8">
                    <input type="text" id="name" placeholder="Seu Nome Completo" class="w-full p-4 rounded-xl border border-gray-200 focus:border-casulo-gold outline-none transition-all placeholder-gray-300" aria-label="Nome Completo">
                    <input type="tel" id="phone" placeholder="WhatsApp (DDD)" class="w-full p-4 rounded-xl border border-gray-200 focus:border-casulo-gold outline-none transition-all placeholder-gray-300" aria-label="N√∫mero de WhatsApp com DDD">
                </div>
                
                <div class="flex flex-col gap-4">
                    <button onclick="finalizeWhatsApp()" class="w-full bg-[#25D366] text-white py-4 rounded-xl font-bold shadow-xl shadow-green-200 hover:shadow-green-300 hover:bg-[#20ba5a] hover:-translate-y-1 transition-all flex justify-center items-center gap-3" aria-label="Confirmar agendamento via WhatsApp">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z" /></svg>
                        Confirmar no WhatsApp
                    </button>
                    <button onclick="finalizeGoogleCalendar()" class="w-full bg-blue-500 text-white py-4 rounded-xl font-bold shadow-xl shadow-blue-200 hover:shadow-blue-300 hover:bg-blue-600 hover:-translate-y-1 transition-all flex justify-center items-center gap-3" aria-label="Adicionar agendamento ao Google Calendar">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/></svg>
                        Adicionar ao Google Calendar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let data = {};
        const services = { 'neuro': 'Avalia√ß√£o Neuropsicol√≥gica', 'tcc': 'Psicoterapia TCC', 'homecare': 'Home Care' };
        const emailAgenda = 'jcantarioandrade@gmail.com'; // E-mail da agenda para integra√ß√£o

        function setStep(n) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step'+n).classList.add('active');
            document.getElementById('progress').style.width = (n * 33.33) + '%';
            // Adiciona foco ao primeiro elemento interativo do novo passo para acessibilidade
            setTimeout(() => {
                const firstInteractiveElement = document.querySelector(`#step${n} a, #step${n} button, #step${n} input, #step${n} [tabindex="0"]`);
                if (firstInteractiveElement) {
                    firstInteractiveElement.focus();
                }
            }, 100);
        }

        function selectService(key, el) {
            data.service = services[key];
            document.querySelectorAll('.service-card').forEach(d => d.classList.remove('selected'));
            el.classList.add('selected');
            // Remove aria-checked de todos e adiciona ao selecionado
            document.querySelectorAll('.service-card').forEach(d => d.setAttribute('aria-checked', 'false'));
            el.setAttribute('aria-checked', 'true');
            setTimeout(() => setStep(2), 300);
        }

        function selectTime(t, el) {
            data.time = t;
            document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
            // Remove aria-checked de todos e adiciona ao selecionado
            document.querySelectorAll('.time-btn').forEach(b => b.setAttribute('aria-checked', 'false'));
            el.setAttribute('aria-checked', 'true');
            checkStep2();
        }

        function checkStep2() {
            data.date = document.getElementById('dateInput').value;
            if(data.date && data.time) {
                document.getElementById('btnStep2').disabled = false;
                document.getElementById('sumService').innerText = data.service;
                document.getElementById('sumDate').innerText = new Date(data.date).toLocaleDateString('pt-BR');
                document.getElementById('sumTime').innerText = data.time;
            } else {
                document.getElementById('btnStep2').disabled = true;
            }
        }

        function finalizeWhatsApp() {
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            if(!name || !phone) {
                alert("Por favor, preencha todos os campos.");
                return;
            }

            const msg = `‚úÖ *NOVO AGENDAMENTO*\n\n*Servi√ßo:* ${data.service}\n*Data:* ${new Date(data.date).toLocaleDateString('pt-BR')}\n*Hora:* ${data.time}\n*Paciente:* ${name}\n*Telefone:* ${phone}`;
            const link = `https://wa.me/5567981106724?text=${encodeURIComponent(msg)}`;
            
            window.open(link, '_blank');
        }

        function finalizeGoogleCalendar() {
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            if(!name || !phone) {
                alert("Por favor, preencha todos os campos.");
                return;
            }

            const eventTitle = `Agendamento: ${data.service} - ${name}`;
            const eventDetails = `Paciente: ${name}\nTelefone: ${phone}\nServi√ßo: ${data.service}`;
            
            const [hours, minutes] = data.time.split(':');
            const selectedDate = new Date(data.date);
            selectedDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);

            // Google Calendar usa fuso hor√°rio local, mas a URL precisa de UTC para ser universal
            // Para simplificar, vamos assumir que o agendamento √© no fuso hor√°rio local e converter para UTC para a URL
            const startDateTime = new Date(selectedDate.getTime() - (selectedDate.getTimezoneOffset() * 60000));
            const endDateTime = new Date(startDateTime.getTime() + (60 * 60 * 1000)); // Dura√ß√£o de 1 hora

            const formatDateTime = (date) => {
                return date.toISOString().replace(/[-:]|\.\d{3}/g, '');
            };

            const googleCalendarLink = `https://calendar.google.com/calendar/render?action=TEMPLATE` +
                `&text=${encodeURIComponent(eventTitle)}` +
                `&dates=${formatDateTime(startDateTime)}/${formatDateTime(endDateTime)}` +
                `&details=${encodeURIComponent(eventDetails)}` +
                `&sf=true` +
                `&output=xml` +
                `&pli=1` +
                `&sprop=website:https://psicologajuliacantario.com.br` +
                `&sprop=name:Dra. J√∫lia Caroline` +
                `&add=${encodeURIComponent(emailAgenda)}`;

            window.open(googleCalendarLink, '_blank');
        }

        // Inicializa o dateInput para n√£o permitir datas passadas
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateInput').setAttribute('min', today);
        });
    </script>

</body>
</html>
